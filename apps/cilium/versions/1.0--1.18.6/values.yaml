# ---------------------------
# Core Cilium Settings (Terraform parity)
# ---------------------------

kubeProxyReplacement: "true"

routingMode: native
ipv4NativeRoutingCIDR: 10.0.16.0/20

bpf:
  masquerade: false

ipam:
  mode: kubernetes

k8sServiceHost: 127.0.0.1
k8sServicePort: 7445   # Talos kube-prism

cgroup:
  autoMount:
    enabled: false
  hostRoot: /sys/fs/cgroup

loadBalancer:
  acceleration: native

# ---------------------------
# Security Context (Talos REQUIRED)
# ---------------------------

securityContext:
  capabilities:
    ciliumAgent:
      - CHOWN
      - KILL
      - NET_ADMIN
      - NET_RAW
      - IPC_LOCK
      - SYS_ADMIN
      - SYS_RESOURCE
      - DAC_OVERRIDE
      - FOWNER
      - SETGID
      - SETUID

    cleanCiliumState:
      - NET_ADMIN
      - SYS_ADMIN
      - SYS_RESOURCE

# ---------------------------
# Operator Scaling (Terraform parity)
# ---------------------------

operator:
  replicas: 2

# ---------------------------
# Encryption (Terraform default: off)
# ---------------------------

encryption:
  enabled: false
  type: wireguard

# ---------------------------
# Hubble (ENABLED by you)
# ---------------------------

hubble:
  enabled: true

  relay:
    enabled: true

  ui:
    enabled: true

  metrics:
    enabled:
      - dns
      - drop
      - tcp
      - flow
      - port-distribution
      - icmp
      - http

# ---------------------------
# Prometheus / Monitoring (ENABLED by you)
# ---------------------------

prometheus:
  serviceMonitor:
    enabled: true
    trustCRDsExist: true

operator:
  prometheus:
    serviceMonitor:
      enabled: true

# ---------------------------
# Ingress Controller (ENABLED by you)
# ---------------------------

ingressController:
  enabled: true
  default: true
  loadbalancerMode: shared
  enforceHttps: true
  defaultSecretNamespace: kube-system
  defaultSecretName: cilium-default-cert

# ---------------------------
# NodePort (Terraform parity)
# ---------------------------

nodePort:
  enabled: true

# ---------------------------
# LB IPAM (Terraform parity â€” Hetzner CCM handles IPs)
# ---------------------------

defaultLBServiceIPAM: ""

# ---------------------------
# Optional: Gateway API (off by default)
# ---------------------------

gatewayAPI:
  enabled: false